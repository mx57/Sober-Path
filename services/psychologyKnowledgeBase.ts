// Расширенная база психологических знаний для AI-коуча

export interface PsychologyKnowledge {
  category: string;
  topics: {
    keyword: string[];
    response: string;
    techniques: string[];
    resources: string[];
  }[];
}

export const psychologyKnowledgeBase: PsychologyKnowledge[] = [
  {
    category: 'Мотивация и целеполагание',
    topics: [
      {
        keyword: ['мотивация', 'нет желания', 'теряю интерес', 'зачем', 'смысл'],
        response: 'Потеря мотивации - это нормальная часть процесса восстановления. Мотивация приходит и уходит волнами. Важно создать систему, которая работает даже когда мотивации нет. Давайте найдем ваши глубинные причины для трезвости - те, что связаны с вашими ценностями.',
        techniques: [
          'Упражнение "Колесо жизни": оцените 8 сфер жизни и увидьте, как алкоголь влияет на каждую',
          'Техника "Письмо себе из будущего": напишите письмо от себя через год трезвости',
          'Визуализация последствий: представьте свою жизнь через 5 лет с алкоголем VS без него'
        ],
        resources: [
          'Книга: "Атомные привычки" Джеймс Клир',
          'Практика: Дневник благодарности за трезвость',
          'Видео: TED Talk "Сила привычек"'
        ]
      },
      {
        keyword: ['сорваться', 'не получится', 'не справлюсь', 'слабый'],
        response: 'Эти мысли называются "катастрофизацией" - когнитивное искажение, при котором мы предсказываем худший исход. Важно отделить мысли от фактов. То, что вы думаете, что сорветесь, не означает, что это произойдет. Давайте проверим эти мысли на реалистичность.',
        techniques: [
          'CBT техника "Проверка мыслей": какие факты за и против этой мысли?',
          'Декатастрофизация: что самое худшее может произойти? Как справитесь?',
          'Поиск альтернативных мыслей: как бы друг посмотрел на эту ситуацию?'
        ],
        resources: [
          'Рабочая тетрадь CBT для зависимостей',
          'Приложение: Трекер когнитивных искажений',
          'Техника: ABCDE модель Альберта Эллиса'
        ]
      }
    ]
  },
  {
    category: 'Эмоциональная регуляция',
    topics: [
      {
        keyword: ['тревога', 'паника', 'страх', 'беспокойство', 'нервничаю'],
        response: 'Тревога - это нормальная эмоция, но при зависимости она может быть усилена. Алкоголь ранее подавлял тревогу, теперь ваш мозг учится справляться с ней естественными способами. Это временно и улучшится с практикой.',
        techniques: [
          'Дыхание 4-7-8: вдох 4, задержка 7, выдох 8 - активирует парасимпатическую систему',
          'Техника заземления 5-4-3-2-1: подключает к настоящему моменту',
          'Прогрессивная мышечная релаксация Джекобсона',
          'Floating техника: наблюдайте тревогу как облако, проплывающее мимо'
        ],
        resources: [
          'Приложение: Headspace или Calm для управления тревогой',
          'Книга: "Осознанность" Марк Уильямс',
          'Практика: Дневник тревоги для выявления триггеров'
        ]
      },
      {
        keyword: ['гнев', 'злость', 'раздражение', 'бешенство', 'ярость'],
        response: 'Гнев часто маскирует более глубокие эмоции - боль, страх, беспомощность. При восстановлении гнев может усилиться, так как алкоголь больше не подавляет эмоции. Важно научиться выражать гнев здоровыми способами.',
        techniques: [
          'RAIN техника: Recognize (распознать), Allow (разрешить), Investigate (исследовать), Nurture (позаботиться)',
          'Техника "Время паузы": заметили гнев - 10 минут паузы перед действием',
          'Физическая разрядка: интенсивные упражнения, битье подушки',
          'Дневник гнева: что произошло? Что почувствовали? Что за этим стоит?'
        ],
        resources: [
          'Книга: "Гнев: укрощение зверя внутри" Рональд Поттер-Эфрон',
          'DBT навыки эмоциональной регуляции',
          'Практика: Лист "Триггеры гнева" для отслеживания паттернов'
        ]
      },
      {
        keyword: ['депрессия', 'грусть', 'печаль', 'тоска', 'безнадежность'],
        response: 'Депрессия часто сопровождает раннее восстановление. Алкоголь нарушал баланс нейромедиаторов, и мозгу нужно время, чтобы восстановиться. Обычно улучшение наступает через 2-4 недели трезвости, но важно обратиться к специалисту, если депрессия тяжелая.',
        techniques: [
          'Поведенческая активация: делайте приятные активности, даже если не хочется',
          'Техника "Маленькие шаги": разбейте задачи на минимальные действия',
          'Социальное подключение: 15 минут общения с поддерживающим человеком ежедневно',
          'Утренний ритуал активации: душ, прогулка, здоровый завтрак'
        ],
        resources: [
          'Самопомощь при депрессии: руководство CBT',
          'Приложение: Moodpath для отслеживания настроения',
          'Важно: консультация психотерапевта при затяжной депрессии'
        ]
      }
    ]
  },
  {
    category: 'Работа с тягой и триггерами',
    topics: [
      {
        keyword: ['хочу выпить', 'тяга', 'искушение', 'соблазн'],
        response: 'Тяга - это волна. Она поднимается, достигает пика и спадает, обычно за 15-30 минут. Ключ - не бороться с ней, а "серфить" по ней. Наблюдайте за ощущениями без осуждения и действия.',
        techniques: [
          'Urge Surfing (Серфинг по тяге): наблюдайте за тягой как волной, где в теле чувствуете, как меняется',
          'Техника HALT: проверьте - Hungry (голоден), Angry (зол), Lonely (одинок), Tired (устал)',
          'Техника задержки: "Подожду 20 минут" - большинство тяг проходит',
          'Замена ритуала: вместо алкоголя - альтернативный ритуал (чай, прогулка)'
        ],
        resources: [
          'Приложение: I Am Sober для отслеживания тяг',
          'Техника: Карточки совладания с тягой',
          'Видео: Mindfulness для работы с тягой'
        ]
      },
      {
        keyword: ['триггер', 'запускает', 'провоцирует', 'напоминает'],
        response: 'Триггеры бывают внешние (места, люди, время) и внутренние (эмоции, мысли). Важно составить карту триггеров и план действий для каждого. На ранних этапах - избегание, позже - навыки совладания.',
        techniques: [
          'Картирование триггеров: список всех известных триггеров + рейтинг силы',
          'План "Если-То": "Если встречу друзей с алкоголем, то позвоню спонсору"',
          'Репетиция ситуаций: мысленная практика сложных сценариев',
          'Создание буферных зон: физическое избегание триггеров на ранних этапах'
        ],
        resources: [
          'Рабочая тетрадь: Триггеры и план совладания',
          'Практика: Ежедневный обзор триггеров',
          'Техника: Экспозиционная терапия (с терапевтом)'
        ]
      }
    ]
  },
  {
    category: 'Когнитивные искажения',
    topics: [
      {
        keyword: ['все или ничего', 'идеально', 'перфекционизм'],
        response: 'Мышление "все или ничего" - частое когнитивное искажение. Реальность не черно-белая. Прогресс не линейный. Даже "плохой" день трезвости лучше дня с алкоголем.',
        techniques: [
          'Техника "Оттенки серого": оцените ситуацию по шкале 0-100, а не 0 или 100',
          'Рефрейминг неудач: "Это не провал, а обучающий опыт"',
          'Журнал прогресса: записывайте даже маленькие победы'
        ],
        resources: [
          'Список когнитивных искажений и противоядий',
          'CBT рабочая тетрадь',
          'Практика: Ежедневная проверка мыслей'
        ]
      },
      {
        keyword: ['всегда', 'никогда', 'все', 'никто'],
        response: 'Сверхобобщение - когнитивное искажение, когда из одного случая делаем вывод обо всем. "Всегда", "никогда", "все" - слова-маркеры. Реальность более нюансированная.',
        techniques: [
          'Техника "Поиск исключений": найдите случаи, когда обобщение не работает',
          'Замена абсолютов на частоты: вместо "всегда" - "часто", "иногда"',
          'Фактчекинг мыслей: какие факты подтверждают и опровергают?'
        ],
        resources: [
          'Список когнитивных искажений',
          'Техника: Сократовский диалог с мыслями',
          'Дневник: Проверка обобщений'
        ]
      }
    ]
  },
  {
    category: 'Социальные ситуации',
    topics: [
      {
        keyword: ['друзья пьют', 'компания', 'вечеринка', 'давление'],
        response: 'Социальное давление - один из самых сложных триггеров. Важно иметь заготовленные ответы, поддерживающих людей и стратегию выхода из ситуации.',
        techniques: [
          'Подготовка отговорок: "Я за рулем", "Принимаю лекарства", "Эксперимент со здоровьем"',
          'Техника "Союзник": возьмите с собой трезвого друга',
          'План побега: как уйти, если станет сложно',
          'Альтернативный напиток: безалкогольное в руке снижает вопросы'
        ],
        resources: [
          'Скрипты для отказа от алкоголя',
          'Практика: Ролевая игра сложных ситуаций',
          'Сообщество: группы поддержки для социализации без алкоголя'
        ]
      },
      {
        keyword: ['одиночество', 'изоляция', 'нет друзей', 'один'],
        response: 'Изоляция - опасный фактор риска. Человек - социальное существо. Важно строить новые, здоровые связи. Это процесс, требующий времени и усилий.',
        techniques: [
          'Маленькие шаги социализации: начните с онлайн-групп, потом очные встречи',
          'Поиск активностей по интересам: хобби-группы, волонтерство, спорт',
          'Группы поддержки: АА, SMART Recovery, онлайн-сообщества',
          'Техника "Один звонок в день": ежедневный контакт с поддерживающим человеком'
        ],
        resources: [
          'Список групп поддержки в вашем городе',
          'Приложение: Meetup для поиска активностей',
          'Сообщество: форумы восстановления'
        ]
      }
    ]
  },
  {
    category: 'Самооценка и идентичность',
    topics: [
      {
        keyword: ['стыд', 'вина', 'позор', 'ненавижу себя'],
        response: 'Стыд и вина - мощные эмоции при зависимости. Важно различать: вина - "я сделал плохое", стыд - "я плохой". Вина может быть продуктивной, стыд - разрушителен. Вы не определяетесь прошлым.',
        techniques: [
          'Техника самосострадания Кристин Нефф: говорите с собой как с другом',
          'Письмо прощения себе: что бы сказали лучшему другу в этой ситуации?',
          'Разделение действия и личности: поступок ≠ личность',
          'Практика благодарности телу: благодарите тело за восстановление'
        ],
        resources: [
          'Книга: "Дары несовершенства" Брене Браун',
          'Медитация самосострадания',
          'Терапия: работа со стыдом с психологом'
        ]
      },
      {
        keyword: ['кто я', 'идентичность', 'потерял себя', 'не знаю'],
        response: 'Алкоголь часто становится частью идентичности. При отказе может возникнуть кризис "кто я без алкоголя?". Это возможность построить новую, аутентичную идентичность.',
        techniques: [
          'Исследование ценностей: что действительно важно для вас?',
          'Техника "Лучшее возможное Я": опишите идеальную версию себя через год',
          'Эксперименты с идентичностью: пробуйте новые активности, роли, интересы',
          'Ревизия убеждений: какие убеждения о себе устарели?'
        ],
        resources: [
          'Упражнения по исследованию ценностей',
          'Книга: "Психология убеждений" Кэрол Двек',
          'Практика: Дневник "Кто я?"'
        ]
      }
    ]
  },
  {
    category: 'Стресс и копинг-стратегии',
    topics: [
      {
        keyword: ['стресс', 'перегрузка', 'не справляюсь', 'давит'],
        response: 'Стресс - главный триггер срывов. Алкоголь был стратегией совладания, теперь нужны новые, здоровые способы. Важно иметь "набор инструментов" для разных уровней стресса.',
        techniques: [
          'Техника стресс-термометра: оцените стресс 1-10, для каждого уровня - свой инструмент',
          'Физические методы: упражнения, йога, прогулка - снижают кортизол',
          'Когнитивные методы: CBT техники, переформулирование',
          'Социальные методы: разговор с другом, группа поддержки',
          'Релаксационные методы: медитация, дыхание, музыка'
        ],
        resources: [
          'Набор инструментов совладания со стрессом',
          'Приложение: Breathe для дыхательных техник',
          'Книга: "Стрессоустойчивость" Шэрон Мельник'
        ]
      }
    ]
  },
  {
    category: 'Сон и здоровье',
    topics: [
      {
        keyword: ['не могу спать', 'бессонница', 'плохой сон'],
        response: 'Нарушения сна - частое явление в раннем восстановлении. Алкоголь нарушал естественные циклы сна. Восстановление может занять 1-3 месяца. Важна гигиена сна.',
        techniques: [
          'Гигиена сна: одно и то же время сна/подъема, прохладная темная комната',
          'Ритуал перед сном: 30 минут расслабляющих активностей',
          'Правило 20 минут: не можете уснуть 20 минут - встаньте, сделайте что-то спокойное',
          'Избегайте: кофеина после 14:00, экранов за час до сна, дневного сна'
        ],
        resources: [
          'Приложение: Sleep Cycle для отслеживания сна',
          'Техника: Сканирование тела для засыпания',
          'При стойкой бессоннице: консультация врача'
        ]
      }
    ]
  }
];

// Функция поиска релевантного ответа
export function findRelevantKnowledge(userMessage: string): {
  response: string;
  techniques: string[];
  resources: string[];
  category: string;
} | null {
  const lowerMessage = userMessage.toLowerCase();
  
  for (const category of psychologyKnowledgeBase) {
    for (const topic of category.topics) {
      const hasKeyword = topic.keyword.some(keyword => 
        lowerMessage.includes(keyword.toLowerCase())
      );
      
      if (hasKeyword) {
        return {
          response: topic.response,
          techniques: topic.techniques,
          resources: topic.resources,
          category: category.category
        };
      }
    }
  }
  
  return null;
}
